<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kmonad: Super Charge Your Keyboard</title>
<meta name="generator" content="Org mode" />
<link rel='stylesheet' href='/css/default.css' />
<link rel='stylesheet' href='/css/source-code.css' />
</head>
<body>
<div id="preamble" class="status">
<h1 id='site-name'>Bryan Rinders</h1>
<div id='menu'>
  <a href='/'>Home</a>
  <a href='/ctf/index.html'>CTF WriteUps</a>
  <a href='/emacs/index.html'>Emacs</a>
  <a href='/linux/index.html'>Linux Tutorials</a>
  <a href='https://gitlab.com/bryos/dotfiles' target='_blank'>Dotfiles</a>
</div>
<br><hr>
</div>
<div id="content">
<h1 class="title">Kmonad: Super Charge Your Keyboard</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#intro">Intro</a></li>
<li><a href="#post-installation">Post installation</a></li>
<li><a href="#configuring">Configuring</a></li>
</ul>
</div>
</div>

<div id="outline-container-org6066d00" class="outline-2">
<h2 id="intro"><a href="#intro">Intro</a></h2>
<div class="outline-text-2" id="text-intro">
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2023-03-02 Thu]</span></span>
</p>

<p>
With <a href="https://github.com/kmonad/kmonad">kmonad</a> you no longer have to buy an expensive programable
keyboard in order to remap every key on your keyboard. Kmonad allows
you to remap keys, create layers, compose keys and more.
</p>
</div>
</div>

<div id="outline-container-org770e9ff" class="outline-2">
<h2 id="post-installation"><a href="#post-installation">Post installation</a></h2>
<div class="outline-text-2" id="text-post-installation">
<p>
After you have installed <code>kmonad</code>, to prevent having to run <code>kmonad</code>
with root priviledges run the following commands and then reboot your
machine. See
<a href="https://github.com/kmonad/kmonad/blob/master/doc/faq.md#q-how-do-i-get-uinput-permissions">Kmonad FAQ</a>
and
<a href="https://github.com/kmonad/kmonad/issues/160#issuecomment-766121884">this</a>
for more info.
</p>


<div class="org-src-container">
<pre class="src src-sh"><span class="org-comment-delimiter"># </span><span class="org-comment">Add self to the input and uinput groups</span>
sudo usermod -aG input $<span class="org-variable-name">USER</span>
sudo groupadd uinput
sudo usermod -aG uinput $<span class="org-variable-name">USER</span>

<span class="org-builtin">echo</span> <span class="org-string">'KERNEL=="uinput", MODE="0660", GROUP="uinput", OPTIONS+="static_node=uinput"'</span> <span class="org-sh-escaped-newline">\</span>
    | sudo tee /etc/udev/rules.d/90-uinput.rules

<span class="org-comment-delimiter"># </span><span class="org-comment">This seems to be needed because uinput isn't compiled as a loadable module these days.</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">See https://github.com/chrippa/ds4drv/issues/93#issuecomment-265300511</span>
<span class="org-builtin">echo</span> uinput | sudo tee /etc/modules-load.d/uinput.conf

sudo modprobe uinput
</pre>
</div>
</div>
</div>

<div id="outline-container-org99c0ca5" class="outline-2">
<h2 id="configuring"><a href="#configuring">Configuring</a></h2>
<div class="outline-text-2" id="text-configuring">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(defcfg
  <span class="org-comment-delimiter">;; </span><span class="org-comment">For Linux</span>
  input  (device-file <span class="org-string">"/dev/input/by-path/platform-i8042-serio-0-event-kbd"</span>)
  output (uinput-sink <span class="org-string">"My KMonad output"</span>
                      <span class="org-string">"/usr/bin/sleep 0.2; /usr/bin/xset r rate 240 60"</span>)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Comment this is you want unhandled events not to be emitted</span>
  fallthrough true

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Set this to false to disable any command-execution in KMonad</span>
  allow-cmd true
)

<span class="org-comment-delimiter">;; </span><span class="org-comment">US</span>
(defsrc
  esc  mute vold volu                          prnt slck pause ins  home pgup
  f1   f2   f3   f4   f5   f6   f7   f8   f9   f10  f11  f12   del  end  pgdn
  grv  1    2    3    4    5    6    7    8    9    0    -     =    bspc
  tab  q    w    e    r    t    y    u    i    o    p    [     ]    \
  caps a    s    d    f    g    h    j    k    l    <span class="org-comment-delimiter">;    </span><span class="org-comment">'          ret</span>
  lsft z    x    c    v    b    n    m    ,    .    /               rsft
  lctl lmet lalt           spc            ralt cmps rctl       back up   fwd
                                                               left down rght
)

<span class="org-comment-delimiter">;; </span><span class="org-comment">Below, I use `</span><span class="org-comment"><span class="org-constant">around</span></span><span class="org-comment">' to compose `</span><span class="org-comment"><span class="org-constant">layer-toggle</span></span><span class="org-comment">' with `</span><span class="org-comment"><span class="org-constant">fn</span></span><span class="org-comment">' (instead</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">of using `</span><span class="org-comment"><span class="org-constant">layer-toggle</span></span><span class="org-comment">' directly) so that the `</span><span class="org-comment"><span class="org-constant">fn</span></span><span class="org-comment">' keypress</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">actually gets emitted. This matters when using an application that</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">can use `</span><span class="org-comment"><span class="org-constant">fn</span></span><span class="org-comment">' as a modifier (like Emacs).</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">(defalias fn (around (layer-toggle function) fn))</span>
(<span class="org-keyword">defalias</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">layer toggles when holding down a key</span>
  num (tap-hold-next-release 200 v (layer-toggle numbers))
  sym (tap-hold-next-release 200 m (layer-toggle symbols))
  arr (tap-hold-next-release 200 t (layer-toggle arrows))
  mse (tap-hold-next-release 200 s (layer-toggle mouse))
  <span class="org-comment-delimiter">;; </span><span class="org-comment">modifier keys when holding down a key</span>
  esca (tap-hold-next-release 200 esc lalt)
  actl (tap-hold-next-release 200 a lctrl)
  octl (tap-hold-next-release 200 o lctrl)
  'alt (tap-hold-next-release 200 ' lalt)
  spcm (tap-hold-next-release 200 spc lmet)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">complex modifier keys</span>
  hyp C-A-S
  meh C-A-M-S
 <span class="org-comment-delimiter">;; </span><span class="org-comment">lead (multi-tap 200 @spcm C-x)  ;; leader key</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">switch base layers for when other people need to use my keyboard</span>
  qwe (layer-switch qwerty)
  col (layer-switch colemak)
)

(deflayer colemak
  esc   mute  vold volu                          @qwe slck  pause ins  home pgup
  f1    f2    f3   f4   f5   f6   f7   f8   f9   f10  f11   f12   del  end  @qwe
  grv   1     2    3    4    5    6    7    8    9    0     -     =    bspc
  tab   q     w    f    p    g    j    l    u    y    <span class="org-comment-delimiter">;     </span><span class="org-comment">[     ]    \</span>
  @esca @actl r    #mse @arr d    h    n    e    i    @octl @'alt      ret
  lsft  z     x    c    @num b    k    @sym ,    .    /                rsft
  lctl  lmet  @meh           @spcm          @hyp ralt rctl        pgdn up   pgup
                                                                  left down rght
)

<span class="org-comment-delimiter">;; </span><span class="org-comment">standard qwerty layer, switch back to colemak by pressing pgdn (@col) on the</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">top right. pgup and pgdn are moved to the arrow keys cluster.</span>
(deflayer qwerty
  esc  mute vold volu                          @col slck pause ins  home pgup
  f1   f2   f3   f4   f5   f6   f7   f8   f9   f10  f11  f12   del  end  @col
  grv  1    2    3    4    5    6    7    8    9    0    -     =    bspc
  tab  q    w    e    r    t    y    u    i    o    p    [     ]    \
  esc  a    s    d    f    g    h    j    k    l    <span class="org-comment-delimiter">;    </span><span class="org-comment">'          ret</span>
  lsft z    x    c    v    b    n    m    ,    .    /               rsft
  lctl lmet lalt           spc            ralt cmps rctl       pgdn up   pgup
                                                               left down rght
)

(deflayer numbers
  _    _    _    _                             _    _    _    _    _    _
  _    _    _    _    _    _    _    _    _    _    _    _    _    _    _
  _    _    _    _    _    _    _    _    _    _    _    _    _    _
  _    _    _    _    _    _    _    7    8    9    +    _    _    _
  _    _    _    lsft _    _    0    4    5    6    *    =         _
  _    _    ,    .    _    _    -    1    2    3    /              _
  _    _    _              _              _    _    _         _    _    _
                                                              _    _    _
)

(deflayer symbols
  _    _    _    _                             _    _    _    _    _    _
  _    _    _    _    _    _    _    _    _    _    _    _    _    _    _
  _    _    _    _    _    _    _    _    _    _    _    _    _    _
  `    !    @    {    }    \    _    _    _    _    _    _    _    _
  _    #    $    \(   \)   &amp;    _    _    _    _    _    _         _
  _    %    ^    [    ]    ~    _    _    _    _    _              _
  _    _    _              _              _    _    _         _    _    _
                                                              _    _    _
)

(deflayer arrows
  _    _    _    _                             _    _    _    _    _    _
  _    _    _    _    _    _    _    _    _    _    _    _    _    _    _
  _    _    _    _    _    _    _    _    _    _    _    _    _    _
  _    _    _    _    _    _    _    _    _    _    _    _    _    _
  _    lalt lctl lsft _    _    left down up   rght _    _         _
  _    _    _    _    _    _    _    _    _    _    _              _
  _    _    _              _              _    _    _         _    _    _
                                                              _    _    _
)

(<span class="org-keyword">defalias</span>
  mup (cmd-button <span class="org-string">"xdotool mousemove_relative -- 0 -15"</span>)
  mdn (cmd-button <span class="org-string">"xdotool mousemove_relative 0 15"</span>)
  mlt (cmd-button <span class="org-string">"xdotool mousemove_relative 15 0"</span>)
  mrt (cmd-button <span class="org-string">"xdotool mousemove_relative -- -15 0"</span>)
  )

(deflayer mouse
  _    _    _    _                             _    _    _    _    _    _
  _    _    _    _    _    _    _    _    _    _    _    _    _    _    _
  _    _    _    _    _    _    _    _    _    _    _    _    _    _
  _    _    _    _    _    _    _    _    _    _    _    _    _    _
  _    _    _    _    _    _    @mrt @mdn @mup @mrt _    _         _
  _    _    _    _    _    _    _    _    _    _    _              _
  _    _    _              _              _    _    _         _    _    _
                                                              _    _    _
)

#|
g and h are marked with XX for easy reference
(deflayer empty
  _    _    _    _                             _    _    _    _    _    _
  _    _    _    _    _    _    _    _    _    _    _    _    _    _    _
  _    _    _    _    _    _    _    _    _    _    _    _    _    _
  _    _    _    _    _    _    _    _    _    _    _    _    _    _
  _    _    _    _    _    XX   XX   _    _    _    _    _         _
  _    _    _    _    _    _    _    _    _    _    _              _
  _    _    _              _              _    _    _         _    _    _
                                                              _    _    _
)
|#
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<br><br>
<div style='text-align: center;'>
  If something is not working, please create an issue
  <a href='https://gitlab.com/bryanrinders/bryanrinders.xyz/-/issues'>here</a>.
</div>
<br><hr/>
<footer>
  <div class='copyright-container'>
    <div class='copyright'>
      Copyright &copy; 2022-2024 Bryan Rinders some rights reserved
      <br><br>
      This page is available under a
      <a rel='license' href='http://creativecommons.org/licenses/by/4.0/'>
        CC-BY 4.0
      </a> licence.
    </div>
  </div>
  <br>
  <div class='generated'>
    Created with <a href="https://www.gnu.org/software/emacs/">Emacs</a> 27.1 (<a href="https://orgmode.org">Org</a> mode 9.3) on <a href='https://www.gnu.org'>GNU</a>+<a href='https://www.kernel.org/'>Linux</a>
  </div>
</footer>
</div>
</body>
</html>
